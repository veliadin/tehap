{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\adinv\\\\Documents\\\\GitHub\\\\tehap\\\\Tehap_FrontEnd\\\\src\\\\components\\\\Activities.js\";\nimport React from 'react';\nimport { useEffect } from 'react';\nimport { useState } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { getActivities, getOldActivities, getNewActivityCount, getNewActivities } from '../api/apiCalls';\nimport { useApiProgress } from '../shared/ApiProgress';\nimport ActivityView from './ActivityView';\nimport Spinner from '../components/Spinner';\nimport { useParams } from 'react-router-dom';\n\nconst Activities = () => {\n  const [activityPage, setActivityPage] = useState({\n    content: [],\n    last: true,\n    number: 0\n  });\n  const [newActivityCount, setNewActivityCount] = useState(0);\n  const {\n    t\n  } = useTranslation();\n  const {\n    username\n  } = useParams();\n  const path = username ? `/api/users/${username}/activities?page=` : `/api/getActivities?page=`;\n  const initialActivityLoadProgress = useApiProgress('get', path);\n  let lastActivityId = 0;\n  let firstActivityId = 0;\n\n  if (activityPage.content.length > 0) {\n    firstActivityId = activityPage.content[0].id;\n    const lastActivityIndex = activityPage.content.length - 1;\n    lastActivityId = activityPage.content[lastActivityIndex].id;\n  }\n\n  const oldActivityPath = username ? `/api/users/${username}/activities/${lastActivityId}` : `/api/getActivities/${lastActivityId}`;\n  const loadOldActivitiesProgress = useApiProgress('get', oldActivityPath, true);\n  const newActivitiesPath = username ? `/api/users/${username}/activities/${firstActivityId}?direction=after` : `/api/getActivities/${firstActivityId}?direction=after`;\n  const loadNewActivitiesProgress = useApiProgress('get', newActivitiesPath, true);\n  useEffect(() => {\n    const getCount = async () => {\n      const response = await getNewActivityCount(firstActivityId, username);\n      setNewActivityCount(response.data.count);\n    };\n\n    let looper = setInterval(getCount, 1000);\n    ;\n    return function cleanup() {\n      clearInterval(looper);\n    };\n  }, [firstActivityId, username]);\n  useEffect(() => {\n    const loadActivities = async page => {\n      try {\n        const response = await getActivities(username, page);\n        setActivityPage(previousActivityPage => ({ ...response.data,\n          content: [...previousActivityPage.content, ...response.data.content]\n        }));\n      } catch (error) {}\n    };\n\n    loadActivities();\n  }, [username]);\n\n  const loadOldActivities = async () => {\n    const response = await getOldActivities(lastActivityId, username);\n    setActivityPage(previousActivityPage => ({ ...response.data,\n      content: [...previousActivityPage.content, ...response.data.content]\n    }));\n  };\n\n  const loadNewActivities = async () => {\n    const response = await getNewActivities(firstActivityId, username);\n    setActivityPage(previousActivityPage => ({ ...previousActivityPage,\n      content: [...response.data, ...previousActivityPage.content]\n    }));\n    setNewActivityCount(0);\n  };\n\n  const onDeleteActivitySuccess = id => {\n    setActivityPage(previousActivityPage => ({ ...previousActivityPage,\n      content: previousActivityPage.content.filter(activity => {\n        if (activity.id !== id) {\n          return true;\n        }\n\n        return false;\n      })\n    }));\n  };\n\n  const {\n    content,\n    last\n  } = activityPage;\n\n  if (content.length === 0) {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"alert alert-secondary text-center\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 98,\n        columnNumber: 16\n      }\n    }, initialActivityLoadProgress ? /*#__PURE__*/React.createElement(Spinner, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 99,\n        columnNumber: 44\n      }\n    }) : t('There are no activities'));\n  }\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 104,\n      columnNumber: 9\n    }\n  }, newActivityCount > 0 && /*#__PURE__*/React.createElement(\"div\", {\n    className: \"alert alert-secondary text-center\",\n    style: {\n      cursor: loadNewActivitiesProgress ? 'not-allowed' : 'pointer'\n    },\n    onClick: loadNewActivitiesProgress ? () => {} : () => loadNewActivities(),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 106,\n      columnNumber: 17\n    }\n  }, loadNewActivitiesProgress ? /*#__PURE__*/React.createElement(Spinner, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 110,\n      columnNumber: 50\n    }\n  }) : t('There are new activities')), content.map(activity => {\n    return /*#__PURE__*/React.createElement(ActivityView, {\n      key: activity.id,\n      activity: activity,\n      onDeleteActivity: onDeleteActivitySuccess,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 114,\n        columnNumber: 24\n      }\n    });\n  }), !last && /*#__PURE__*/React.createElement(\"div\", {\n    className: \"alert alert-secondary text-center\",\n    style: {\n      cursor: loadOldActivitiesProgress ? 'not-allowed' : 'pointer'\n    },\n    onClick: loadOldActivitiesProgress ? () => {} : () => loadOldActivities(),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 117,\n      columnNumber: 17\n    }\n  }, loadOldActivitiesProgress ? /*#__PURE__*/React.createElement(Spinner, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 122,\n      columnNumber: 50\n    }\n  }) : t('Load new activities')));\n};\n\nexport default Activities;","map":{"version":3,"sources":["C:/Users/adinv/Documents/GitHub/tehap/Tehap_FrontEnd/src/components/Activities.js"],"names":["React","useEffect","useState","useTranslation","getActivities","getOldActivities","getNewActivityCount","getNewActivities","useApiProgress","ActivityView","Spinner","useParams","Activities","activityPage","setActivityPage","content","last","number","newActivityCount","setNewActivityCount","t","username","path","initialActivityLoadProgress","lastActivityId","firstActivityId","length","id","lastActivityIndex","oldActivityPath","loadOldActivitiesProgress","newActivitiesPath","loadNewActivitiesProgress","getCount","response","data","count","looper","setInterval","cleanup","clearInterval","loadActivities","page","previousActivityPage","error","loadOldActivities","loadNewActivities","onDeleteActivitySuccess","filter","activity","cursor","map"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport { useEffect } from 'react';\r\nimport { useState } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { getActivities, getOldActivities, getNewActivityCount, getNewActivities } from '../api/apiCalls';\r\nimport { useApiProgress } from '../shared/ApiProgress';\r\nimport ActivityView from './ActivityView';\r\nimport Spinner from '../components/Spinner';\r\nimport { useParams } from 'react-router-dom';\r\n\r\nconst Activities = () => {\r\n\r\n    const [activityPage, setActivityPage] = useState({ content: [], last: true, number: 0 });\r\n    const [newActivityCount, setNewActivityCount] = useState(0);\r\n    const { t } = useTranslation();\r\n    const { username } = useParams();\r\n\r\n\r\n    const path = username ? `/api/users/${username}/activities?page=` : `/api/getActivities?page=`;\r\n    const initialActivityLoadProgress = useApiProgress('get', path);\r\n\r\n    let lastActivityId = 0;\r\n    let firstActivityId = 0;\r\n    if (activityPage.content.length > 0) {\r\n        firstActivityId = activityPage.content[0].id;\r\n        const lastActivityIndex = activityPage.content.length - 1;\r\n        lastActivityId = activityPage.content[lastActivityIndex].id;\r\n\r\n    }\r\n    const oldActivityPath = username ? `/api/users/${username}/activities/${lastActivityId}` : `/api/getActivities/${lastActivityId}`;\r\n    const loadOldActivitiesProgress = useApiProgress('get', oldActivityPath, true)\r\n\r\n    const newActivitiesPath = username ? `/api/users/${username}/activities/${firstActivityId}?direction=after` : `/api/getActivities/${firstActivityId}?direction=after`\r\n\r\n    const loadNewActivitiesProgress = useApiProgress('get', newActivitiesPath, true)\r\n\r\n\r\n    useEffect(() => {\r\n        const getCount = async () => {\r\n            const response = await getNewActivityCount(firstActivityId, username);\r\n            setNewActivityCount(response.data.count);\r\n        }\r\n        let looper = setInterval(getCount, 1000);\r\n        ;\r\n        return function cleanup() {\r\n            clearInterval(looper);\r\n        }\r\n    }, [firstActivityId, username])\r\n\r\n\r\n    useEffect(() => {\r\n        const loadActivities = async page => {\r\n            try {\r\n                const response = await getActivities(username, page);\r\n                setActivityPage(previousActivityPage => ({\r\n                    ...response.data,\r\n                    content: [...previousActivityPage.content, ...response.data.content]\r\n                }))\r\n            } catch (error) { }\r\n        };\r\n        loadActivities();\r\n    }, [username]);\r\n\r\n\r\n    const loadOldActivities = async () => {\r\n\r\n        const response = await getOldActivities(lastActivityId, username);\r\n        setActivityPage(previousActivityPage => ({\r\n            ...response.data,\r\n            content: [...previousActivityPage.content, ...response.data.content]\r\n        }))\r\n    }\r\n\r\n    const loadNewActivities = async () => {\r\n        const response = await getNewActivities(firstActivityId, username);\r\n        setActivityPage(previousActivityPage => ({\r\n            ...previousActivityPage,\r\n            content: [...response.data, ...previousActivityPage.content]\r\n        }));\r\n        setNewActivityCount(0);\r\n    }\r\n\r\n    const onDeleteActivitySuccess = (id) => {\r\n        setActivityPage(previousActivityPage => ({\r\n            ...previousActivityPage,\r\n            content: previousActivityPage.content.filter((activity) => {\r\n                if (activity.id !== id) {\r\n                    return true\r\n                }\r\n                return false;\r\n            })\r\n        }))\r\n    }\r\n\r\n    const { content, last } = activityPage;\r\n\r\n    if (content.length === 0) {\r\n        return <div className=\"alert alert-secondary text-center\">\r\n            {initialActivityLoadProgress ? <Spinner /> : t('There are no activities')}\r\n        </div>\r\n    }\r\n\r\n    return (\r\n        <div>\r\n            {newActivityCount > 0 && (\r\n                <div className=\"alert alert-secondary text-center\"\r\n                    style={{ cursor: loadNewActivitiesProgress ? 'not-allowed' : 'pointer' }}\r\n                    onClick={loadNewActivitiesProgress ? () => { } : () => loadNewActivities()}\r\n                >\r\n                    {loadNewActivitiesProgress ? <Spinner /> : t('There are new activities')}\r\n                </div>\r\n            )}\r\n            {content.map(activity => {\r\n                return <ActivityView key={activity.id} activity={activity} onDeleteActivity={onDeleteActivitySuccess}></ActivityView>\r\n            })}\r\n            {!last &&\r\n                <div\r\n                    className=\"alert alert-secondary text-center\"\r\n                    style={{ cursor: loadOldActivitiesProgress ? 'not-allowed' : 'pointer' }}\r\n                    onClick={loadOldActivitiesProgress ? () => { } : () => loadOldActivities()}\r\n                >\r\n                    {loadOldActivitiesProgress ? <Spinner /> : t('Load new activities')}\r\n                </div>}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default Activities;"]},"metadata":{},"sourceType":"module"}