{"ast":null,"code":"import _regeneratorRuntime from\"D:\\\\JsProjects\\\\Tehap_FrontEnd\\\\Tehap_FrontEnd\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"D:\\\\JsProjects\\\\Tehap_FrontEnd\\\\Tehap_FrontEnd\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _objectSpread from\"D:\\\\JsProjects\\\\Tehap_FrontEnd\\\\Tehap_FrontEnd\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"D:\\\\JsProjects\\\\Tehap_FrontEnd\\\\Tehap_FrontEnd\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from\"react\";import{useHistory,useParams}from\"react-router-dom\";import{useSelector,useDispatch}from\"react-redux\";import ProfileImageWithDefault from'./ProfileImageWithDefault';import{useTranslation}from\"react-i18next\";import Input from\"../components/Input\";import{deleteUser,updateUser}from\"../api/apiCalls\";import{useApiProgress}from\"../shared/ApiProgress\";import ButtonWithProgress from'../components/ButtonWithProgress';import{logoutSucces,updateSuccess}from'../redux/authActions';import Activities from\"./Activities\";import Modal from'./Modal';var ProfileCard=function ProfileCard(props){var _useSelector=useSelector(function(store){return{username:store.username};}),loggedInUsername=_useSelector.username;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),inEditMode=_useState2[0],setInEditMode=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),updatedDisplayName=_useState4[0],setUpdatedDisplayName=_useState4[1];var _useState5=useState({}),_useState6=_slicedToArray(_useState5,2),user=_useState6[0],setUser=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),editable=_useState8[0],setEditable=_useState8[1];var _useState9=useState(),_useState10=_slicedToArray(_useState9,2),newImage=_useState10[0],setNewImage=_useState10[1];var _useState11=useState({}),_useState12=_slicedToArray(_useState11,2),validationErrors=_useState12[0],setValidationErrors=_useState12[1];var _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),modalVisible=_useState14[0],setModalVisible=_useState14[1];var history=useHistory();var dispatch=useDispatch();//const { user } = props;\nvar routeParams=useParams();var pathUsername=routeParams.username;useEffect(function(){setUser(props.user);},[props.user]);useEffect(function(){setEditable(pathUsername===loggedInUsername);},[pathUsername,loggedInUsername]);var username=user.username,displayName=user.displayName,image=user.image,branch=user.branch,usersurname=user.usersurname,email=user.email,university=user.university;var pendingApiCallDeleteUser=useApiProgress('delete',\"/api/users/delete/\".concat(username),true);var _useTranslation=useTranslation(),t=_useTranslation.t;useEffect(function(){if(!inEditMode){setUpdatedDisplayName(undefined);setNewImage(undefined);}else{setUpdatedDisplayName(displayName);}},[inEditMode,displayName]);useEffect(function(){setValidationErrors(function(previousValidationErrors){return _objectSpread(_objectSpread({},previousValidationErrors),{},{displayName:undefined});});},[updatedDisplayName]);useEffect(function(){setValidationErrors(function(previousValidationErrors){return _objectSpread(_objectSpread({},previousValidationErrors),{},{image:undefined});});},[newImage]);var onClickEdit=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var image,body,response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(newImage){image=newImage.split(',')[1];}body={displayName:updatedDisplayName,image:image};_context.prev=2;_context.next=5;return updateUser(username,body);case 5:response=_context.sent;setInEditMode(false);setUser(response.data);dispatch(updateSuccess(response.data));_context.next=14;break;case 11:_context.prev=11;_context.t0=_context[\"catch\"](2);setValidationErrors(_context.t0.response.data.validationErrors);case 14:case\"end\":return _context.stop();}}},_callee,null,[[2,11]]);}));return function onClickEdit(){return _ref.apply(this,arguments);};}();var onChangeFile=function onChangeFile(event){if(event.target.files.length<1){return;}var file=event.target.files[0];var fileReader=new FileReader();fileReader.onloadend=function(){setNewImage(fileReader.result);};fileReader.readAsDataURL(file);};var onClickCancel=function onClickCancel(){setModalVisible(false);};var onClickDeleteUser=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return deleteUser(username);case 2:setModalVisible(false);dispatch(logoutSucces());history.push('/');case 5:case\"end\":return _context2.stop();}}},_callee2);}));return function onClickDeleteUser(){return _ref2.apply(this,arguments);};}();var message=\"We cannot edit\";if(pathUsername===loggedInUsername){message=\"We can edit\";}var pendingApiCall=useApiProgress('put','/api/users/'+username);var displayNameError=validationErrors.displayName,imageError=validationErrors.image;return/*#__PURE__*/React.createElement(\"div\",{className:\"container\"},/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"div\",{className:\"main-body\"},/*#__PURE__*/React.createElement(\"div\",{className:\"row gutters-sm\"},/*#__PURE__*/React.createElement(\"div\",{className:\"col-md-4 mb-3\"},/*#__PURE__*/React.createElement(\"div\",{className:\"card\"},/*#__PURE__*/React.createElement(\"div\",{className:\"card-body\"},/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex flex-column align-items-center text-center\"},/*#__PURE__*/React.createElement(ProfileImageWithDefault,{className:\"rounded-circle shadow\",width:\"150\",height:\"160\",alt:\"\".concat(username,\" profile\"),image:image,temimage:newImage}),/*#__PURE__*/React.createElement(\"div\",{className:\"mt-3\"},!inEditMode&&/*#__PURE__*/React.createElement(\"h4\",null,displayName),editable&&/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"button\",{className:\"btn btn-success  d-inline-flex\",onClick:function onClick(){return setInEditMode(true);}},/*#__PURE__*/React.createElement(\"span\",{className:\"material-icons\"},\"edit\"),t('Edit')),/*#__PURE__*/React.createElement(\"div\",{className:\"pt-2\"},/*#__PURE__*/React.createElement(\"button\",{className:\"btn btn-danger d-inline-flex\",onClick:function onClick(){return setModalVisible(true);}},/*#__PURE__*/React.createElement(\"span\",{className:\"material-icons\"},\"person_remove\"),t('Delete My Account')))),inEditMode&&/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(Input,{label:t('Change Display Name'),defaultValue:displayName,onChange:function onChange(event){setUpdatedDisplayName(event.target.value);},error:displayNameError}),/*#__PURE__*/React.createElement(Input,{type:\"file\",onChange:onChangeFile,error:imageError}),/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(ButtonWithProgress,{className:\"btn btn-primary d-inline-flex\",onClick:onClickEdit,disabled:pendingApiCall,pendingApiCall:pendingApiCall,text:/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"i\",{className:\"material-icons\"},\"save\"),t('Save'))}),/*#__PURE__*/React.createElement(\"button\",{className:\"btn btn-light d-inline-flex ml-1\",onClick:function onClick(){return setInEditMode(false);},disabled:pendingApiCall},/*#__PURE__*/React.createElement(\"i\",{className:\"material-icons\"},\"close\"),t('Cancel')))),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"p\",{className:\"text-secondary mb-1\"},/*#__PURE__*/React.createElement(\"strong\",null,branch)),/*#__PURE__*/React.createElement(\"button\",{className:\"btn btn-primary\"},t('Follow'))))))),/*#__PURE__*/React.createElement(\"div\",{className:\"col-md-8\"},/*#__PURE__*/React.createElement(\"div\",{className:\"card mb-3\"},/*#__PURE__*/React.createElement(\"div\",{className:\"card-body\"},/*#__PURE__*/React.createElement(\"div\",{className:\"row\"},/*#__PURE__*/React.createElement(\"div\",{className:\"col-sm-3\"},/*#__PURE__*/React.createElement(\"h6\",{className:\"mb-0\"},t('Name and Surname'))),/*#__PURE__*/React.createElement(\"div\",{className:\"col-sm-9 text-secondary\"},username+\" \"+usersurname)),/*#__PURE__*/React.createElement(\"hr\",null),/*#__PURE__*/React.createElement(\"div\",{className:\"row\"},/*#__PURE__*/React.createElement(\"div\",{className:\"col-sm-3\"},/*#__PURE__*/React.createElement(\"h6\",{className:\"mb-0\"},t('Email'))),/*#__PURE__*/React.createElement(\"div\",{className:\"col-sm-9 text-secondary\"},email)),/*#__PURE__*/React.createElement(\"hr\",null),/*#__PURE__*/React.createElement(\"div\",{className:\"row\"},/*#__PURE__*/React.createElement(\"div\",{className:\"col-sm-3\"},/*#__PURE__*/React.createElement(\"h6\",{className:\"mb-0\"},t('University'))),/*#__PURE__*/React.createElement(\"div\",{className:\"col-sm-9 text-secondary\"},university)),/*#__PURE__*/React.createElement(\"hr\",null),/*#__PURE__*/React.createElement(\"div\",{className:\"row\"},/*#__PURE__*/React.createElement(\"div\",{className:\"col-sm-3\"},/*#__PURE__*/React.createElement(\"h6\",{className:\"mb-0\"},t('Branch'))),/*#__PURE__*/React.createElement(\"div\",{className:\"col-sm-9 text-secondary\"},branch)))),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"div\",{className:\"col-sm-12 mb-12\"},/*#__PURE__*/React.createElement(\"h4\",{className:\"card-title\"},t('Events to Attend')),/*#__PURE__*/React.createElement(\"div\",{className:\"card h-100\"},/*#__PURE__*/React.createElement(\"div\",{className:\"card-body\"},/*#__PURE__*/React.createElement(\"div\",{className:\"col-12\"},/*#__PURE__*/React.createElement(Activities,null)))))))),/*#__PURE__*/React.createElement(Modal,{visible:modalVisible,onClickCancel:onClickCancel,onClickOk:onClickDeleteUser,title:t('Delete My Account'),okButtonText:t('Delete My Account'),pendingApiCall:pendingApiCallDeleteUser,message:/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"strong\",null,t('Are you sure to delete your account?')))//pendingApiCall={pendingApiCall}\n}))/*\r\n    <div className=\"card text-center\">\r\n      <div className=\"card-header\">\r\n        <ProfileImageWithDefault\r\n          className=\"rounded-circle shadow\"\r\n          width=\"150\"\r\n          height=\"160\"\r\n          alt={`${username} profile`}\r\n          image={image}\r\n          temimage={newImage}\r\n        />\r\n      </div>\r\n      <div className=\"card-body\">\r\n        {(!inEditMode &&\r\n          <>\r\n            <h4>\r\n              {displayName}\r\n              {username}\r\n            </h4>\r\n\r\n            {editable && <button\r\n              className=\"btn btn-success  d-inline-flex\"\r\n              onClick={() => setInEditMode(true)}>\r\n              <span className=\"material-icons\">edit</span>\r\n              {t('Edit')}</button>}\r\n          </>\r\n        )}\r\n        {(inEditMode && (\r\n          <div>\r\n            <Input\r\n              label={t('Change Display Name')}\r\n              defaultValue={displayName}\r\n              onChange={(event) => {\r\n                setUpdatedDisplayName(event.target.value)\r\n              }} />\r\n            <input type=\"file\" onChange={onChangeFile} />\r\n            <div>\r\n              <ButtonWithProgress\r\n                className=\"btn btn-primary d-inline-flex\"\r\n                onClick={onClickEdit}\r\n                disabled={pendingApiCall}\r\n                pendingApiCall={pendingApiCall}\r\n                text={\r\n                  <>\r\n                    <i className=\"material-icons\">save</i>\r\n                    {t('Save')}\r\n                  </>\r\n                }\r\n              />\r\n\r\n\r\n              <button\r\n                className=\"btn btn-light d-inline-flex ml-1\"\r\n                onClick={() => setInEditMode(false)}\r\n                disabled={pendingApiCall}>\r\n                <i className=\"material-icons\">close</i>\r\n                {t('Cancel')}\r\n              </button>\r\n            </div>\r\n          </div>\r\n        ))}\r\n\r\n\r\n      </div>\r\n\r\n    </div>*/;};export default ProfileCard;","map":{"version":3,"sources":["D:/JsProjects/Tehap_FrontEnd/Tehap_FrontEnd/src/components/ProfileCard.js"],"names":["React","useEffect","useState","useHistory","useParams","useSelector","useDispatch","ProfileImageWithDefault","useTranslation","Input","deleteUser","updateUser","useApiProgress","ButtonWithProgress","logoutSucces","updateSuccess","Activities","Modal","ProfileCard","props","store","username","loggedInUsername","inEditMode","setInEditMode","updatedDisplayName","setUpdatedDisplayName","user","setUser","editable","setEditable","newImage","setNewImage","validationErrors","setValidationErrors","modalVisible","setModalVisible","history","dispatch","routeParams","pathUsername","displayName","image","branch","usersurname","email","university","pendingApiCallDeleteUser","t","undefined","previousValidationErrors","onClickEdit","split","body","response","data","onChangeFile","event","target","files","length","file","fileReader","FileReader","onloadend","result","readAsDataURL","onClickCancel","onClickDeleteUser","push","message","pendingApiCall","displayNameError","imageError","value"],"mappings":"oqBAAA,MAAOA,CAAAA,KAAP,EAAgBC,SAAhB,CAA2BC,QAA3B,KAA2C,OAA3C,CACA,OAASC,UAAT,CAAqBC,SAArB,KAAsC,kBAAtC,CACA,OAASC,WAAT,CAAsBC,WAAtB,KAAyC,aAAzC,CACA,MAAOC,CAAAA,uBAAP,KAAoC,2BAApC,CACA,OAASC,cAAT,KAA+B,eAA/B,CACA,MAAOC,CAAAA,KAAP,KAAkB,qBAAlB,CACA,OAASC,UAAT,CAAqBC,UAArB,KAAuC,iBAAvC,CACA,OAASC,cAAT,KAA+B,uBAA/B,CACA,MAAOC,CAAAA,kBAAP,KAA+B,kCAA/B,CACA,OAASC,YAAT,CAAuBC,aAAvB,KAA4C,sBAA5C,CACA,MAAOC,CAAAA,UAAP,KAAuB,cAAvB,CACA,MAAOC,CAAAA,KAAP,KAAkB,SAAlB,CAGA,GAAMC,CAAAA,WAAW,CAAG,QAAdA,CAAAA,WAAc,CAACC,KAAD,CAAW,kBACUd,WAAW,CAAC,SAACe,KAAD,CAAW,CAC5D,MAAO,CACLC,QAAQ,CAAED,KAAK,CAACC,QADX,CAAP,CAGD,CAJiD,CADrB,CACXC,gBADW,cACrBD,QADqB,eAMOnB,QAAQ,CAAC,KAAD,CANf,wCAMtBqB,UANsB,eAMVC,aANU,8BAOuBtB,QAAQ,EAP/B,yCAOtBuB,kBAPsB,eAOFC,qBAPE,8BAQLxB,QAAQ,CAAC,EAAD,CARH,yCAQtByB,IARsB,eAQhBC,OARgB,8BASG1B,QAAQ,CAAC,KAAD,CATX,yCAStB2B,QATsB,eASZC,WATY,8BAUG5B,QAAQ,EAVX,0CAUtB6B,QAVsB,gBAUZC,WAVY,gCAWmB9B,QAAQ,CAAC,EAAD,CAX3B,2CAWtB+B,gBAXsB,gBAWJC,mBAXI,gCAYWhC,QAAQ,CAAC,KAAD,CAZnB,2CAYtBiC,YAZsB,gBAYRC,eAZQ,gBAa7B,GAAMC,CAAAA,OAAO,CAAGlC,UAAU,EAA1B,CAEA,GAAMmC,CAAAA,QAAQ,CAAGhC,WAAW,EAA5B,CAEA;AACA,GAAMiC,CAAAA,WAAW,CAAGnC,SAAS,EAA7B,CACA,GAAMoC,CAAAA,YAAY,CAAGD,WAAW,CAAClB,QAAjC,CAEApB,SAAS,CAAC,UAAM,CACd2B,OAAO,CAACT,KAAK,CAACQ,IAAP,CAAP,CACD,CAFQ,CAEN,CAACR,KAAK,CAACQ,IAAP,CAFM,CAAT,CAIA1B,SAAS,CAAC,UAAM,CACd6B,WAAW,CAACU,YAAY,GAAKlB,gBAAlB,CAAX,CACD,CAFQ,CAEN,CAACkB,YAAD,CAAelB,gBAAf,CAFM,CAAT,CAzB6B,GA6BrBD,CAAAA,QA7BqB,CA6BoDM,IA7BpD,CA6BrBN,QA7BqB,CA6BXoB,WA7BW,CA6BoDd,IA7BpD,CA6BXc,WA7BW,CA6BEC,KA7BF,CA6BoDf,IA7BpD,CA6BEe,KA7BF,CA6BSC,MA7BT,CA6BoDhB,IA7BpD,CA6BSgB,MA7BT,CA6BiBC,WA7BjB,CA6BoDjB,IA7BpD,CA6BiBiB,WA7BjB,CA6B8BC,KA7B9B,CA6BoDlB,IA7BpD,CA6B8BkB,KA7B9B,CA6BqCC,UA7BrC,CA6BoDnB,IA7BpD,CA6BqCmB,UA7BrC,CA+B7B,GAAMC,CAAAA,wBAAwB,CAAGnC,cAAc,CAAC,QAAD,6BAAgCS,QAAhC,EAA4C,IAA5C,CAA/C,CA/B6B,oBAkCfb,cAAc,EAlCC,CAkCrBwC,CAlCqB,iBAkCrBA,CAlCqB,CAoC7B/C,SAAS,CAAC,UAAM,CACd,GAAI,CAACsB,UAAL,CAAiB,CACfG,qBAAqB,CAACuB,SAAD,CAArB,CACAjB,WAAW,CAACiB,SAAD,CAAX,CACD,CAHD,IAGO,CACLvB,qBAAqB,CAACe,WAAD,CAArB,CACD,CACF,CAPQ,CAON,CAAClB,UAAD,CAAakB,WAAb,CAPM,CAAT,CASAxC,SAAS,CAAC,UAAM,CACdiC,mBAAmB,CAAC,SAACgB,wBAAD,CAA8B,CAChD,sCACKA,wBADL,MAEET,WAAW,CAAEQ,SAFf,GAID,CALkB,CAAnB,CAMD,CAPQ,CAON,CAACxB,kBAAD,CAPM,CAAT,CASAxB,SAAS,CAAC,UAAM,CACdiC,mBAAmB,CAAC,SAACgB,wBAAD,CAA8B,CAChD,sCACKA,wBADL,MAEER,KAAK,CAAEO,SAFT,GAID,CALkB,CAAnB,CAMD,CAPQ,CAON,CAAClB,QAAD,CAPM,CAAT,CASA,GAAMoB,CAAAA,WAAW,0FAAG,2JAElB,GAAIpB,QAAJ,CAAc,CACZW,KAAK,CAAGX,QAAQ,CAACqB,KAAT,CAAe,GAAf,EAAoB,CAApB,CAAR,CACD,CACKC,IALY,CAKL,CACXZ,WAAW,CAAEhB,kBADF,CAEXiB,KAAK,CAALA,KAFW,CALK,uCAUO/B,CAAAA,UAAU,CAACU,QAAD,CAAWgC,IAAX,CAVjB,QAUVC,QAVU,eAWhB9B,aAAa,CAAC,KAAD,CAAb,CACAI,OAAO,CAAC0B,QAAQ,CAACC,IAAV,CAAP,CACAjB,QAAQ,CAACvB,aAAa,CAACuC,QAAQ,CAACC,IAAV,CAAd,CAAR,CAbgB,iFAehBrB,mBAAmB,CAAC,YAAMoB,QAAN,CAAeC,IAAf,CAAoBtB,gBAArB,CAAnB,CAfgB,qEAAH,kBAAXkB,CAAAA,WAAW,0CAAjB,CAmBA,GAAMK,CAAAA,YAAY,CAAG,QAAfA,CAAAA,YAAe,CAACC,KAAD,CAAW,CAC9B,GAAIA,KAAK,CAACC,MAAN,CAAaC,KAAb,CAAmBC,MAAnB,CAA4B,CAAhC,CAAmC,CACjC,OACD,CACD,GAAMC,CAAAA,IAAI,CAAGJ,KAAK,CAACC,MAAN,CAAaC,KAAb,CAAmB,CAAnB,CAAb,CACA,GAAMG,CAAAA,UAAU,CAAG,GAAIC,CAAAA,UAAJ,EAAnB,CACAD,UAAU,CAACE,SAAX,CAAuB,UAAM,CAC3BhC,WAAW,CAAC8B,UAAU,CAACG,MAAZ,CAAX,CACD,CAFD,CAGAH,UAAU,CAACI,aAAX,CAAyBL,IAAzB,EACD,CAVD,CAYA,GAAMM,CAAAA,aAAa,CAAG,QAAhBA,CAAAA,aAAgB,EAAM,CAC1B/B,eAAe,CAAC,KAAD,CAAf,CACD,CAFD,CAIA,GAAMgC,CAAAA,iBAAiB,2FAAG,+JAClB1D,CAAAA,UAAU,CAACW,QAAD,CADQ,QAExBe,eAAe,CAAC,KAAD,CAAf,CACAE,QAAQ,CAACxB,YAAY,EAAb,CAAR,CACAuB,OAAO,CAACgC,IAAR,CAAa,GAAb,EAJwB,wDAAH,kBAAjBD,CAAAA,iBAAiB,2CAAvB,CAQA,GAAIE,CAAAA,OAAO,CAAG,gBAAd,CACA,GAAI9B,YAAY,GAAKlB,gBAArB,CAAuC,CACrCgD,OAAO,CAAG,aAAV,CACD,CACD,GAAMC,CAAAA,cAAc,CAAG3D,cAAc,CAAC,KAAD,CAAQ,cAAgBS,QAAxB,CAArC,CA9G6B,GAgHRmD,CAAAA,gBAhHQ,CAgHgCvC,gBAhHhC,CAgHrBQ,WAhHqB,CAgHiBgC,UAhHjB,CAgHgCxC,gBAhHhC,CAgHUS,KAhHV,CAiH7B,mBAEE,2BAAK,SAAS,CAAC,WAAf,eACE,8BADF,cAEE,2BAAK,SAAS,CAAC,WAAf,eACE,2BAAK,SAAS,CAAC,gBAAf,eACE,2BAAK,SAAS,CAAC,eAAf,eACE,2BAAK,SAAS,CAAC,MAAf,eACE,2BAAK,SAAS,CAAC,WAAf,eACE,2BAAK,SAAS,CAAC,mDAAf,eACE,oBAAC,uBAAD,EACE,SAAS,CAAC,uBADZ,CAEE,KAAK,CAAC,KAFR,CAGE,MAAM,CAAC,KAHT,CAIE,GAAG,WAAKrB,QAAL,YAJL,CAKE,KAAK,CAAEqB,KALT,CAME,QAAQ,CAAEX,QANZ,EADF,cAYE,2BAAK,SAAS,CAAC,MAAf,EACI,CAACR,UAAD,eACA,8BAAKkB,WAAL,CAFJ,CAIGZ,QAAQ,eACP,qDACE,8BACE,SAAS,CAAC,gCADZ,CAEE,OAAO,CAAE,yBAAML,CAAAA,aAAa,CAAC,IAAD,CAAnB,EAFX,eAGE,4BAAM,SAAS,CAAC,gBAAhB,SAHF,CAIGwB,CAAC,CAAC,MAAD,CAJJ,CADF,cAOE,2BAAK,SAAS,CAAC,MAAf,eACE,8BACE,SAAS,CAAC,8BADZ,CAEE,OAAO,CAAE,yBAAMZ,CAAAA,eAAe,CAAC,IAAD,CAArB,EAFX,eAGE,4BAAM,SAAS,CAAC,gBAAhB,kBAHF,CAIGY,CAAC,CAAC,mBAAD,CAJJ,CADF,CAPF,CALJ,CAyBIzB,UAAU,eACV,4CACE,oBAAC,KAAD,EACE,KAAK,CAAEyB,CAAC,CAAC,qBAAD,CADV,CAEE,YAAY,CAAEP,WAFhB,CAGE,QAAQ,CAAE,kBAACgB,KAAD,CAAW,CACnB/B,qBAAqB,CAAC+B,KAAK,CAACC,MAAN,CAAagB,KAAd,CAArB,CACD,CALH,CAME,KAAK,CAAEF,gBANT,EADF,cASE,oBAAC,KAAD,EAAO,IAAI,CAAC,MAAZ,CAAmB,QAAQ,CAAEhB,YAA7B,CAA2C,KAAK,CAAEiB,UAAlD,EATF,cAUE,4CACE,oBAAC,kBAAD,EACE,SAAS,CAAC,+BADZ,CAEE,OAAO,CAAEtB,WAFX,CAGE,QAAQ,CAAEoB,cAHZ,CAIE,cAAc,CAAEA,cAJlB,CAKE,IAAI,cACF,qDACE,yBAAG,SAAS,CAAC,gBAAb,SADF,CAEGvB,CAAC,CAAC,MAAD,CAFJ,CANJ,EADF,cAaE,8BACE,SAAS,CAAC,kCADZ,CAEE,OAAO,CAAE,yBAAMxB,CAAAA,aAAa,CAAC,KAAD,CAAnB,EAFX,CAGE,QAAQ,CAAE+C,cAHZ,eAIE,yBAAG,SAAS,CAAC,gBAAb,UAJF,CAKGvB,CAAC,CAAC,QAAD,CALJ,CAbF,CAVF,CA1BJ,cA2DE,8BA3DF,cA2DW,8BA3DX,cA4DE,yBAAG,SAAS,CAAC,qBAAb,eAAmC,kCAASL,MAAT,CAAnC,CA5DF,cA6DE,8BAAQ,SAAS,CAAC,iBAAlB,EAAqCK,CAAC,CAAC,QAAD,CAAtC,CA7DF,CAZF,CADF,CADF,CADF,CADF,cAoFE,2BAAK,SAAS,CAAC,UAAf,eACE,2BAAK,SAAS,CAAC,WAAf,eACE,2BAAK,SAAS,CAAC,WAAf,eACE,2BAAK,SAAS,CAAC,KAAf,eACE,2BAAK,SAAS,CAAC,UAAf,eACE,0BAAI,SAAS,CAAC,MAAd,EAAsBA,CAAC,CAAC,kBAAD,CAAvB,CADF,CADF,cAIE,2BAAK,SAAS,CAAC,yBAAf,EACG3B,QAAQ,CAAG,GAAX,CAAiBuB,WADpB,CAJF,CADF,cASE,8BATF,cAUE,2BAAK,SAAS,CAAC,KAAf,eACE,2BAAK,SAAS,CAAC,UAAf,eACE,0BAAI,SAAS,CAAC,MAAd,EAAsBI,CAAC,CAAC,OAAD,CAAvB,CADF,CADF,cAIE,2BAAK,SAAS,CAAC,yBAAf,EACGH,KADH,CAJF,CAVF,cAkBE,8BAlBF,cAmBE,2BAAK,SAAS,CAAC,KAAf,eACE,2BAAK,SAAS,CAAC,UAAf,eACE,0BAAI,SAAS,CAAC,MAAd,EAAsBG,CAAC,CAAC,YAAD,CAAvB,CADF,CADF,cAIE,2BAAK,SAAS,CAAC,yBAAf,EACGF,UADH,CAJF,CAnBF,cA2BE,8BA3BF,cA4BE,2BAAK,SAAS,CAAC,KAAf,eACE,2BAAK,SAAS,CAAC,UAAf,eACE,0BAAI,SAAS,CAAC,MAAd,EAAsBE,CAAC,CAAC,QAAD,CAAvB,CADF,CADF,cAIE,2BAAK,SAAS,CAAC,yBAAf,EACGL,MADH,CAJF,CA5BF,CADF,CADF,cAwCE,8BAxCF,cAyCE,2BAAK,SAAS,CAAC,iBAAf,eACE,0BAAI,SAAS,CAAC,YAAd,EAA4BK,CAAC,CAAC,kBAAD,CAA7B,CADF,cAEE,2BAAK,SAAS,CAAC,YAAf,eACE,2BAAK,SAAS,CAAC,WAAf,eACE,2BAAK,SAAS,CAAC,QAAf,eACE,oBAAC,UAAD,MADF,CADF,CADF,CAFF,CAzCF,CApFF,CADF,CAFF,cA6IE,oBAAC,KAAD,EAAO,OAAO,CAAEb,YAAhB,CACE,aAAa,CAAEgC,aADjB,CAEE,SAAS,CAAEC,iBAFb,CAGE,KAAK,CAAEpB,CAAC,CAAC,mBAAD,CAHV,CAIE,YAAY,CAAEA,CAAC,CAAC,mBAAD,CAJjB,CAKE,cAAc,CAAED,wBALlB,CAME,OAAO,cAEL,qDACE,kCACGC,CAAC,CAAC,sCAAD,CADJ,CADF,CAOJ;AAfA,EA7IF,CAiKA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;YAnKF,CAsOD,CAvVD,CAyVA,cAAe9B,CAAAA,WAAf","sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport { useHistory, useParams } from \"react-router-dom\";\r\nimport { useSelector, useDispatch } from \"react-redux\";\r\nimport ProfileImageWithDefault from './ProfileImageWithDefault';\r\nimport { useTranslation } from \"react-i18next\";\r\nimport Input from \"../components/Input\";\r\nimport { deleteUser, updateUser } from \"../api/apiCalls\";\r\nimport { useApiProgress } from \"../shared/ApiProgress\";\r\nimport ButtonWithProgress from '../components/ButtonWithProgress';\r\nimport { logoutSucces, updateSuccess } from '../redux/authActions'\r\nimport Activities from \"./Activities\";\r\nimport Modal from './Modal';\r\n\r\n\r\nconst ProfileCard = (props) => {\r\n  const { username: loggedInUsername } = useSelector((store) => {\r\n    return {\r\n      username: store.username,\r\n    };\r\n  });\r\n  const [inEditMode, setInEditMode] = useState(false);\r\n  const [updatedDisplayName, setUpdatedDisplayName] = useState();\r\n  const [user, setUser] = useState({});\r\n  const [editable, setEditable] = useState(false);\r\n  const [newImage, setNewImage] = useState();\r\n  const [validationErrors, setValidationErrors] = useState({});\r\n  const [modalVisible, setModalVisible] = useState(false);\r\n  const history = useHistory();\r\n\r\n  const dispatch = useDispatch();\r\n\r\n  //const { user } = props;\r\n  const routeParams = useParams();\r\n  const pathUsername = routeParams.username;\r\n\r\n  useEffect(() => {\r\n    setUser(props.user);\r\n  }, [props.user]);\r\n\r\n  useEffect(() => {\r\n    setEditable(pathUsername === loggedInUsername)\r\n  }, [pathUsername, loggedInUsername])\r\n\r\n  const { username, displayName, image, branch, usersurname, email, university } = user;\r\n\r\n  const pendingApiCallDeleteUser = useApiProgress('delete', `/api/users/delete/${username}`, true);\r\n\r\n\r\n  const { t } = useTranslation();\r\n\r\n  useEffect(() => {\r\n    if (!inEditMode) {\r\n      setUpdatedDisplayName(undefined);\r\n      setNewImage(undefined);\r\n    } else {\r\n      setUpdatedDisplayName(displayName);\r\n    }\r\n  }, [inEditMode, displayName]);\r\n\r\n  useEffect(() => {\r\n    setValidationErrors((previousValidationErrors) => {\r\n      return {\r\n        ...previousValidationErrors,\r\n        displayName: undefined\r\n      }\r\n    });\r\n  }, [updatedDisplayName])\r\n\r\n  useEffect(() => {\r\n    setValidationErrors((previousValidationErrors) => {\r\n      return {\r\n        ...previousValidationErrors,\r\n        image: undefined\r\n      }\r\n    });\r\n  }, [newImage])\r\n\r\n  const onClickEdit = async () => {\r\n    let image;\r\n    if (newImage) {\r\n      image = newImage.split(',')[1];\r\n    }\r\n    const body = {\r\n      displayName: updatedDisplayName,\r\n      image\r\n    };\r\n    try {\r\n      const response = await updateUser(username, body);\r\n      setInEditMode(false);\r\n      setUser(response.data)\r\n      dispatch(updateSuccess(response.data));\r\n    } catch (error) {\r\n      setValidationErrors(error.response.data.validationErrors);\r\n    }\r\n  }\r\n\r\n  const onChangeFile = (event) => {\r\n    if (event.target.files.length < 1) {\r\n      return;\r\n    }\r\n    const file = event.target.files[0];\r\n    const fileReader = new FileReader();\r\n    fileReader.onloadend = () => {\r\n      setNewImage(fileReader.result);\r\n    }\r\n    fileReader.readAsDataURL(file);\r\n  }\r\n\r\n  const onClickCancel = () => {\r\n    setModalVisible(false);\r\n  };\r\n\r\n  const onClickDeleteUser = async () => {\r\n    await deleteUser(username);\r\n    setModalVisible(false);\r\n    dispatch(logoutSucces());\r\n    history.push('/');\r\n  }\r\n\r\n\r\n  let message = \"We cannot edit\";\r\n  if (pathUsername === loggedInUsername) {\r\n    message = \"We can edit\";\r\n  }\r\n  const pendingApiCall = useApiProgress('put', '/api/users/' + username);\r\n\r\n  const { displayName: displayNameError, image: imageError } = validationErrors;\r\n  return (\r\n\r\n    <div className=\"container\">\r\n      <br></br>\r\n      <div className=\"main-body\">\r\n        <div className=\"row gutters-sm\">\r\n          <div className=\"col-md-4 mb-3\">\r\n            <div className=\"card\">\r\n              <div className=\"card-body\">\r\n                <div className=\"d-flex flex-column align-items-center text-center\">\r\n                  <ProfileImageWithDefault\r\n                    className=\"rounded-circle shadow\"\r\n                    width=\"150\"\r\n                    height=\"160\"\r\n                    alt={`${username} profile`}\r\n                    image={image}\r\n                    temimage={newImage}\r\n                  />\r\n\r\n\r\n\r\n                  <div className=\"mt-3\">\r\n                    {(!inEditMode &&\r\n                      <h4>{displayName}</h4>)}\r\n\r\n                    {editable && (\r\n                      <>\r\n                        <button\r\n                          className=\"btn btn-success  d-inline-flex\"\r\n                          onClick={() => setInEditMode(true)}>\r\n                          <span className=\"material-icons\">edit</span>\r\n                          {t('Edit')}\r\n                        </button>\r\n                        <div className=\"pt-2\">\r\n                          <button\r\n                            className=\"btn btn-danger d-inline-flex\"\r\n                            onClick={() => setModalVisible(true)}>\r\n                            <span className=\"material-icons\">person_remove</span>\r\n                            {t('Delete My Account')}\r\n                          </button>\r\n                        </div>\r\n\r\n                      </>\r\n                    )}\r\n\r\n\r\n                    {(inEditMode && (\r\n                      <div>\r\n                        <Input\r\n                          label={t('Change Display Name')}\r\n                          defaultValue={displayName}\r\n                          onChange={(event) => {\r\n                            setUpdatedDisplayName(event.target.value)\r\n                          }}\r\n                          error={displayNameError}\r\n                        />\r\n                        <Input type=\"file\" onChange={onChangeFile} error={imageError} />\r\n                        <div>\r\n                          <ButtonWithProgress\r\n                            className=\"btn btn-primary d-inline-flex\"\r\n                            onClick={onClickEdit}\r\n                            disabled={pendingApiCall}\r\n                            pendingApiCall={pendingApiCall}\r\n                            text={\r\n                              <>\r\n                                <i className=\"material-icons\">save</i>\r\n                                {t('Save')}\r\n                              </>\r\n                            }\r\n                          />\r\n                          <button\r\n                            className=\"btn btn-light d-inline-flex ml-1\"\r\n                            onClick={() => setInEditMode(false)}\r\n                            disabled={pendingApiCall}>\r\n                            <i className=\"material-icons\">close</i>\r\n                            {t('Cancel')}\r\n                          </button>\r\n                        </div>\r\n                      </div>\r\n                    ))}\r\n                    <br></br><br></br>\r\n                    <p className=\"text-secondary mb-1\"><strong>{branch}</strong></p>\r\n                    <button className=\"btn btn-primary\">{t('Follow')}</button>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n          </div>\r\n          <div className=\"col-md-8\">\r\n            <div className=\"card mb-3\">\r\n              <div className=\"card-body\">\r\n                <div className=\"row\">\r\n                  <div className=\"col-sm-3\">\r\n                    <h6 className=\"mb-0\">{t('Name and Surname')}</h6>\r\n                  </div>\r\n                  <div className=\"col-sm-9 text-secondary\">\r\n                    {username + \" \" + usersurname}\r\n                  </div>\r\n                </div>\r\n                <hr></hr>\r\n                <div className=\"row\">\r\n                  <div className=\"col-sm-3\">\r\n                    <h6 className=\"mb-0\">{t('Email')}</h6>\r\n                  </div>\r\n                  <div className=\"col-sm-9 text-secondary\">\r\n                    {email}\r\n                  </div>\r\n                </div>\r\n                <hr></hr>\r\n                <div className=\"row\">\r\n                  <div className=\"col-sm-3\">\r\n                    <h6 className=\"mb-0\">{t('University')}</h6>\r\n                  </div>\r\n                  <div className=\"col-sm-9 text-secondary\">\r\n                    {university}\r\n                  </div>\r\n                </div>\r\n                <hr></hr>\r\n                <div className=\"row\">\r\n                  <div className=\"col-sm-3\">\r\n                    <h6 className=\"mb-0\">{t('Branch')}</h6>\r\n                  </div>\r\n                  <div className=\"col-sm-9 text-secondary\">\r\n                    {branch}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <br></br>\r\n            <div className=\"col-sm-12 mb-12\">\r\n              <h4 className=\"card-title\">{t('Events to Attend')}</h4>\r\n              <div className=\"card h-100\">\r\n                <div className=\"card-body\">\r\n                  <div className=\"col-12\">\r\n                    <Activities />\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <Modal visible={modalVisible}\r\n        onClickCancel={onClickCancel}\r\n        onClickOk={onClickDeleteUser}\r\n        title={t('Delete My Account')}\r\n        okButtonText={t('Delete My Account')}\r\n        pendingApiCall={pendingApiCallDeleteUser}\r\n        message=\r\n        {\r\n          <>{\r\n            <strong>\r\n              {t('Are you sure to delete your account?')}\r\n            </strong>\r\n          }\r\n          </>\r\n        }\r\n      //pendingApiCall={pendingApiCall}\r\n      />\r\n    </div>\r\n\r\n\r\n    /*\r\n    <div className=\"card text-center\">\r\n      <div className=\"card-header\">\r\n        <ProfileImageWithDefault\r\n          className=\"rounded-circle shadow\"\r\n          width=\"150\"\r\n          height=\"160\"\r\n          alt={`${username} profile`}\r\n          image={image}\r\n          temimage={newImage}\r\n        />\r\n      </div>\r\n      <div className=\"card-body\">\r\n        {(!inEditMode &&\r\n          <>\r\n            <h4>\r\n              {displayName}\r\n              {username}\r\n            </h4>\r\n\r\n            {editable && <button\r\n              className=\"btn btn-success  d-inline-flex\"\r\n              onClick={() => setInEditMode(true)}>\r\n              <span className=\"material-icons\">edit</span>\r\n              {t('Edit')}</button>}\r\n          </>\r\n        )}\r\n        {(inEditMode && (\r\n          <div>\r\n            <Input\r\n              label={t('Change Display Name')}\r\n              defaultValue={displayName}\r\n              onChange={(event) => {\r\n                setUpdatedDisplayName(event.target.value)\r\n              }} />\r\n            <input type=\"file\" onChange={onChangeFile} />\r\n            <div>\r\n              <ButtonWithProgress\r\n                className=\"btn btn-primary d-inline-flex\"\r\n                onClick={onClickEdit}\r\n                disabled={pendingApiCall}\r\n                pendingApiCall={pendingApiCall}\r\n                text={\r\n                  <>\r\n                    <i className=\"material-icons\">save</i>\r\n                    {t('Save')}\r\n                  </>\r\n                }\r\n              />\r\n\r\n\r\n              <button\r\n                className=\"btn btn-light d-inline-flex ml-1\"\r\n                onClick={() => setInEditMode(false)}\r\n                disabled={pendingApiCall}>\r\n                <i className=\"material-icons\">close</i>\r\n                {t('Cancel')}\r\n              </button>\r\n            </div>\r\n          </div>\r\n        ))}\r\n\r\n\r\n      </div>\r\n\r\n    </div>*/\r\n  );\r\n};\r\n\r\nexport default ProfileCard;\r\n"]},"metadata":{},"sourceType":"module"}